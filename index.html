<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Analyse-Tool mit KI-PromptChain</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 960px; margin: auto; padding: 20px; }
    textarea, select, input[type="text"] {
      width: 100%; margin-top: 5px; padding: 6px; font-family: monospace;
    }
    textarea { height: 180px; }
    .analyse-block { margin-bottom: 30px; border-top: 1px solid #ccc; padding-top: 20px; }
    .button-group { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    h2 { margin-top: 40px; }
    .xml-box { background: #f8f8f8; border: 1px solid #ccc; padding: 15px; white-space: pre-wrap; margin-top: 15px; font-family: monospace; }
    .top-tag-input input { color: red; font-weight: bold; }
    .warn-tag-button { background-color: #eee; border: 1px solid #ccc; padding: 6px 10px; margin: 5px 5px 0 0; cursor: pointer; border-radius: 4px; }
    .warn-tag-button.active { background-color: #4CAF50; color: white; }
    .tooltip { border-bottom: 1px dotted black; cursor: help; }
  </style>
</head>
<body>
  <h1>Analyse-Tool – XML mit PromptChain</h1>

  <label for="beitragstitel">Beitragstitel:</label>
  <input type="text" id="beitragstitel" placeholder="Beitragstitel eingeben" />

  <label for="ressort">Ressort:</label>
  <select id="ressort">
    <option value="">– Bitte wählen –</option>
    <option>Politik</option>
    <option>Wirtschaft</option>
    <option>Kultur</option>
    <option>Sport</option>
    <option>Wissen</option>
    <option>Gesellschaft</option>
    <option>Panorama</option>
    <option>Digitales</option>
    <option>Verbraucher</option>
    <option>Gesundheit</option>
    <option>Bildung</option>
    <option>Umwelt</option>
    <option>Verkehr</option>
    <option>Justiz</option>
    <option>Ausland</option>
  </select>

  <label>Top-Tags <span class="tooltip" title="Max. 5 priorisierte Begriffe, die den thematischen Fokus der Analyse verstärken">[?]</span></label>
  <div id="topTags" class="top-tag-input"></div>
  <button onclick="addTopTag()">+ Top-Tag hinzufügen</button>

  <label>Warn-Tags <span class="tooltip" title="Wähle markierte Themen, die sensible Inhalte kennzeichnen">[?]</span></label><br>
  <div id="warnTags">
    <span class="warn-tag-button" onclick="toggleWarnTag(this, 'Mutmaßung')">Mutmaßung</span>
    <span class="warn-tag-button" onclick="toggleWarnTag(this, 'Vorverurteilung')">Vorverurteilung</span>
    <span class="warn-tag-button" onclick="toggleWarnTag(this, 'Falschmeldung')">Falschmeldung</span>
    <span class="warn-tag-button" onclick="toggleWarnTag(this, 'Identitätsschutz')">Identitätsschutz</span>
    <span class="warn-tag-button" onclick="toggleWarnTag(this, 'rechtlich sensibel')">rechtlich sensibel</span>
  </div>

  <label>Thema <span class="tooltip" title="Kontextuelles Thema für die Einordnung">[?]</span></label>
  <input type="text" id="kontextThema" />

  <label>Ort <span class="tooltip" title="Region oder Stadt für die Einordnung">[?]</span></label>
  <input type="text" id="kontextOrt" />

  <label>Ereignis <span class="tooltip" title="Art des Ereignisses, z. B. Brand, Urteil">[?]</span></label>
  <input type="text" id="kontextEreignis" />

  <div class="analyse-block">
    <h2>Transkript</h2>
    <label for="transkript">Text:</label>
    <textarea id="transkript" placeholder="Transkript eingeben..."></textarea>
    <label>Zitate erlaubt?</label>
    <select id="zitateTranskript">
      <option value="true">Ja</option>
      <option value="false" selected>Nein</option>
    </select>
    <label>Gewichtung:</label>
    <select id="weightTranskript">
      <option value="0">0 %</option>
      <option value="25">25 %</option>
      <option value="50">50 %</option>
      <option value="75" selected>75 %</option>
      <option value="100">100 %</option>
    </select>
  </div>

  <div class="analyse-block">
    <h2>Anmoderation</h2>
    <label for="anmoderation">Text:</label>
    <textarea id="anmoderation" placeholder="Anmoderation eingeben..."></textarea>
    <label>Zitate erlaubt?</label>
    <select id="zitateAnmoderation">
      <option value="true">Ja</option>
      <option value="false" selected>Nein</option>
    </select>
    <label>Gewichtung:</label>
    <select id="weightAnmoderation">
      <option value="0">0 %</option>
      <option value="25" selected>25 %</option>
      <option value="50">50 %</option>
      <option value="75">75 %</option>
      <option value="100">100 %</option>
    </select>
  </div>

  <div class="button-group">
    <button onclick="generateFinalXML()">Finales XML erzeugen</button>
    <button onclick="copyToClipboard()">XML kopieren</button>
    <button onclick="downloadXML()">XML herunterladen</button>
  </div>

  <h2>XML zum Kopieren</h2>
  <div id="finalXml" class="xml-box"></div>

  <script>
    let topTagCount = 0;
    function addTopTag() {
      if (topTagCount >= 5) return;
      const input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("placeholder", "Top-Tag eingeben...");
      document.getElementById("topTags").appendChild(input);
      topTagCount++;
    }

    const selectedWarnTags = new Set();
    function toggleWarnTag(el, tag) {
      if (selectedWarnTags.has(tag)) {
        selectedWarnTags.delete(tag);
        el.classList.remove("active");
      } else {
        selectedWarnTags.add(tag);
        el.classList.add("active");
      }
    }

    function escapeXml(str) {
      return str.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&apos;");
    }

    function generateFinalXML() {
      const isoTime = new Date().toISOString();
      const titel = escapeXml(document.getElementById("beitragstitel").value);
      const ressort = escapeXml(document.getElementById("ressort").value);
      const topTags = Array.from(document.getElementById("topTags").querySelectorAll("input")).map(input => escapeXml(input.value)).filter(Boolean);
      const kontextThema = escapeXml(document.getElementById("kontextThema").value);
      const kontextOrt = escapeXml(document.getElementById("kontextOrt").value);
      const kontextEreignis = escapeXml(document.getElementById("kontextEreignis").value);
      const warnTags = Array.from(selectedWarnTags).map(tag => `    <tag typ=\"warnung\">${escapeXml(tag)}</tag>`).join("\n");

      const transcript = escapeXml(document.getElementById("transkript").value);
      const zitatT = document.getElementById("zitateTranskript").value;
      const weightT = document.getElementById("weightTranskript").value;
      const anmoderation = escapeXml(document.getElementById("anmoderation").value);
      const zitatA = document.getElementById("zitateAnmoderation").value;
      const weightA = document.getElementById("weightAnmoderation").value;

      const xml = `<?xml version="1.0" encoding="UTF-8"?>
<online-ausgabe version="1.0">
  <verarbeitung automatisch="true" />
  <top-tags>
${topTags.map(tag => `    <tag priorität=\"hoch\">${tag}</tag>`).join("\n")}
  </top-tags>
  <warn-tags>
${warnTags}
  </warn-tags>
  <kontext-tags>
    <tag typ="thema" nutzung="kontext">${kontextThema}</tag>
    <tag typ="ort" nutzung="kontext">${kontextOrt}</tag>
    <tag typ="ereignis" nutzung="kontext">${kontextEreignis}</tag>
  </kontext-tags>
  <quelle>
    <zeitstempel>${isoTime}</zeitstempel>
    <titel>${titel}</titel>
    <ressort>${ressort}</ressort>
    <analysearten>
      <transkript gewichtung="${weightT}">
        <zitate-erlaubt>${zitatT}</zitate-erlaubt>
        <originaltext>${transcript}</originaltext>
        <analyse>
          <schritt nummer="2"></schritt>
          <schritt nummer="3"></schritt>
          <schritt nummer="4"></schritt>
          <schritt nummer="5"></schritt>
          <schritt nummer="6"></schritt>
        </analyse>
      </transkript>
      <anmoderation gewichtung="${weightA}">
        <zitate-erlaubt>${zitatA}</zitate-erlaubt>
        <originaltext>${anmoderation}</originaltext>
        <analyse>
          <schritt nummer="2"></schritt>
          <schritt nummer="3"></schritt>
          <schritt nummer="4"></schritt>
          <schritt nummer="5"></schritt>
          <schritt nummer="6"></schritt>
        </analyse>
      </anmoderation>
    </analysearten>
  </quelle>
  <editorial-metadata>
    <ueberschrift länge-max="60"></ueberschrift>
    <kurzbeschreibung länge-max="150"></kurzbeschreibung>
    <seo>
      <keywords max="10">
        <keyword></keyword>
      </keywords>
      <themen max="5">
        <thema></thema>
      </themen>
    </seo>
  </editorial-metadata>
</online-ausgabe>`;

      document.getElementById("finalXml").textContent = xml;
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(document.getElementById("finalXml").textContent);
    }

    function downloadXML() {
      const blob = new Blob([document.getElementById("finalXml").textContent], { type: "application/xml" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "finale-online-ausgabe.xml";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
